<!doctype html>
<html>
<head>
	<meta charset="utf8">
	<title></title>
</head>
<body>



	<script type="text/javascript" >
		window.scenes = []

		var createArena = function(size){
			var canvas = document.createElement('canvas')
			canvas.height = size.height
			canvas.width = size.width
			canvas.backgroundColor = 'wheat'
			document.body.appendChild(canvas)

			return canvas
		}

		var botWidth = 20
		var botHeight = 20

		var botBox = function(coords){
			return [
				coords.x - botWidth/2,
				coords.y - botHeight/2,
				botWidth,
				botHeight
			]
		}

		var drawBots = function(arena, bots){
			var ctx = arena.getContext('2d')
			ctx.fillStyle = 'black'
			ctx.fillRect(0, 0, arena.width, arena.height)

			bots.forEach(function(bot){
				ctx.save();
				ctx.beginPath();
				// ctx.translate(bot.position.x, bot.position.y);
				// ctx.rotate(bot.heading);
				ctx.rect.apply(ctx, botBox(bot.position));
				ctx.fillStyle = "maroon";
				ctx.fill();
				ctx.lineWidth = 2;
				ctx.strokeStyle = "wheat";
				ctx.stroke();
				ctx.closePath();
				ctx.restore();
			})

		}

		var play = function(){
			console.log('play')
			console.log(scenes.length)

			if (scenes.length > 0)
				drawBots(arena, scenes.shift().bots)

			setTimeout(play, 250)
		}

		play()


		var ws = new WebSocket('ws://__HOST__:__PORT__')
		// console.log(ws)

		ws.onmessage = function(e){
			try {
				var parsedData = JSON.parse(e.data)
				// console.log(parsedData)

				if (parsedData.arena)
					window.arena = createArena(parsedData.arena)

				if (parsedData.tick)
					scenes.push(parsedData.scene)



			}
			catch(error){
				console.error(error)
				console.log(e.data)
			}
		}

		ws.onclose = function(e){
			console.log('closed connection to server')
			console.log(e)
		}

		// ws.onopen = function(){
		// 	ws.send('hello')
		// }

	</script>
</body>
</html>
